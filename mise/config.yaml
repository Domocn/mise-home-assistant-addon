# Home Assistant Add-on Configuration
name: "Mise"
version: "3.0.14"
slug: "mise"
description: "Self-hosted family recipe management with PostgreSQL, Redis, and background job processing"
url: "https://github.com/Domocn/Mise"
arch:
  - amd64
  - aarch64
ingress: true
ingress_port: 3000
ingress_stream: true
panel_icon: mdi:chef-hat
panel_title: Mise
homeassistant_api: true
init: false

# Map config and data directories for persistence
map:
  - homeassistant_config:rw
  - share:rw
  - ssl:ro

# Ports configuration
ports:
  3000/tcp: null
  8001/tcp: null
  5555/tcp: null

ports_description:
  3000/tcp: "Web UI (optional, use ingress instead)"
  8001/tcp: "Backend API (optional)"
  5555/tcp: "Flower Dashboard (job monitoring, optional)"

# Add-on options with defaults
options:
  jwt_secret: ""
  llm_provider: "embedded"
  ollama_url: "http://homeassistant.local:11434"
  ollama_model: "llama3"
  openai_api_key: ""
  anthropic_api_key: ""
  google_ai_api_key: ""
  email_enabled: false
  smtp_server: ""
  smtp_port: 587
  smtp_username: ""
  smtp_password: ""
  smtp_from_email: ""
  enable_registration: true
  enable_oauth_google: false
  google_client_id: ""
  google_client_secret: ""
  enable_oauth_github: false
  github_client_id: ""
  github_client_secret: ""
  postgres_max_connections: 100
  postgres_shared_buffers: "256MB"
  redis_maxmemory: "256mb"
  celery_concurrency: 2
  enable_flower_dashboard: true
  debug_mode: false

# Schema for validating options
schema:
  jwt_secret: "str?"
  llm_provider: "list(embedded|ollama|openai|anthropic|google)?"
  ollama_url: "url?"
  ollama_model: "str?"
  openai_api_key: "str?"
  anthropic_api_key: "str?"
  google_ai_api_key: "str?"
  email_enabled: "bool?"
  smtp_server: "str?"
  smtp_port: "int?"
  smtp_username: "str?"
  smtp_password: "str?"
  smtp_from_email: "str?"
  enable_registration: "bool?"
  enable_oauth_google: "bool?"
  google_client_id: "str?"
  google_client_secret: "str?"
  enable_oauth_github: "bool?"
  github_client_id: "str?"
  github_client_secret: "str?"
  postgres_max_connections: "int?"
  postgres_shared_buffers: "str?"
  redis_maxmemory: "str?"
  celery_concurrency: "int?"
  enable_flower_dashboard: "bool?"
  debug_mode: "bool?"

# Environment variables from options
environment:
  MISE_HA_ADDON: "true"

# Backup paths
backup_exclude:
  - "*.log"
  - "__pycache__"
  - "node_modules"
  - "*.pyc"
  - "/data/postgres/pg_log"
